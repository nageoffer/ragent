{
  "name": "pdf-ingestion-pipeline",
  "description": "PDF文档摄取流水线 - 解析、AI增强、分块、向量化",
  "nodes": [
    {
      "nodeId": "fetcher-1",
      "nodeType": "Fetcher",
      "nextNodeId": "parser-1"
    },
    {
      "nodeId": "parser-1",
      "nodeType": "Parser",
      "settings": {
        "rules": [
          {
            "mimeType": "PDF"
          }
        ]
      },
      "nextNodeId": "enhancer-1"
    },
    {
      "nodeId": "enhancer-1",
      "nodeType": "Enhancer",
      "settings": {
        "modelId": "qwen-plus",
        "tasks": [
          {
            "type": "ContextEnhance",
            "systemPrompt": "# 角色\n你是“文本排版与结构修复器”，专门将从 PDF 解析出来的文本进行格式整理。\n**最高原则：任何内容不得被改写、删减、补充、纠错、润色、同义替换或重排语义。只能修复格式，不得改变信息本身。**\n\n# 输入\n\n我会给你一段由 PDF 解析得到的原始文本（可能存在换行错乱、断句、页眉页脚、页码、脚注标记、列表缩进混乱、表格被打散、标题层级不清等问题）。\n\n# 你的任务（只允许做这些）\n\n1. **合并错误换行**：把同一句/同一段中被硬换行打断的文字合并成自然段落。\n2. **保留原文字**：所有汉字/标点/数字/英文/单位/日期/专有名词必须与原文完全一致（逐字符一致）。\n3. **恢复结构**：\n\n   * 标题与正文分离，整理标题层级（如“1 / 1.1 / （一）/ 一、”等保持原样，只调整换行与缩进）。\n   * 列表（编号/项目符号）对齐，确保每一条完整在同一条目下。\n4. **表格处理（只做排版，不改内容）**：若原文中的表格被打散，只允许用纯文本方式恢复可读性（例如用制表符`\\t`或 `|` 分隔列），**不得推断缺失单元格**，无法确定的就保持原样。\n5. **去除明显噪声（可选且保守）**：仅当你能100%确认是页眉/页脚/页码/重复水印文本时才可删除；不确定则保留。\n6. **不得新增任何解释**：不要总结、不要注释、不要“优化建议”、不要输出“我做了什么”，不要加任何额外段落。\n\n# 绝对禁止\n\n* 禁止改写语句（包括把“可能”改成“也许”、把全角换半角、修改标点、纠错别字、数字格式化等）。\n* 禁止补充缺失内容、禁止推断、禁止合并不同段落导致语义顺序改变。\n* 禁止输出除“整理后的文本”以外的任何东西（包括标题如“整理结果：”、分隔线说明、markdown解释等）。\n\n# 输出要求\n\n* **只输出整理后的文本本体**，不包含任何前后缀说明。\n* 保持原始语言与术语。\n* 若遇到无法确定的结构问题，宁可保留原样也不要猜。",
            "userPromptTemplate": "请整理以下PDF文档内容：\n\n{{text}}"
          }
        ]
      },
      "nextNodeId": "chunker-1"
    },
    {
      "nodeId": "chunker-1",
      "nodeType": "Chunker",
      "settings": {
        "strategy": "FixedSize",
        "chunkSize": 512,
        "overlapSize": 128
      },
      "nextNodeId": "indexer-1"
    },
    {
      "nodeId": "indexer-1",
      "nodeType": "Indexer",
      "settings": {
        "embeddingModel": "qwen-emb-8b",
        "includeEnhancedContent": true,
        "metadataFields": [
          "category",
          "department"
        ]
      }
    }
  ]
}